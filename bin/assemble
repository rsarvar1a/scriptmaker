#!/usr/bin/env python

import json
import yaml
import os

from operator import itemgetter
from pathlib import Path

REAL_TEAMS = ['townsfolk', 'outsider', 'minion', 'demon', 'traveller', 'fabled', 'loric']

official = {}
nightmeta = {}

root = Path('data/characters')
for p in root.rglob('**/*.yml'):
    entry = yaml.load(open(p, 'r'), yaml.Loader)
    id, team = itemgetter('id', 'team')(entry)
    if id == '_meta': continue
    print(p)
    (official if team in REAL_TEAMS else nightmeta)[id] = entry

try:
    os.mkdir('generated')
except:
    pass

with open('scriptmaker/data/compiled/official.json', 'w') as f:
    json.dump(official, f, indent=2, sort_keys=True)

with open('scriptmaker/data/compiled/nightmeta.json', 'w') as f:
    json.dump(nightmeta, f, indent=2, sort_keys=True)
